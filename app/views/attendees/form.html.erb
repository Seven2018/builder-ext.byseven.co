<div class="container-seven-form">
  <div id='attendee-form-logo'>
    <%= image_tag "SEVENLOGO_SQUARE2.png" %>
    <img src="<%= @training.client_contact.client_company.logo %>" alt="" >
  </div>
  <div id='attendee-form'>
    <% status = !params[:search].nil? %>
    <div id="attendee-form-title">
      <h3>Formulaire d'inscription</h3>
      <h4><%= @training.title %></h4>
    </div>
    <%= simple_form_for :search, url: training_attendees_form_path(@training), method: 'GET' do |f| %>
      <% if (status && !Attendee.where(email: params[:search][:email]).empty?) || (params[:attendee] && Attendee.find(params[:attendee].to_i)) %>
        <% attendee = Attendee.find(params[:attendee].to_i) if params[:attendee] %>
        <% attendee = Attendee.where(email: params[:search][:email]).first if params[:search] %>
        <div style='display:flex;justify-content:space-around;'>
          <%= f.input :firstname, label: 'Prénom', input_html: { value: attendee.firstname}, disabled: true, required: false %>
          <%= f.input :lastname, label: 'Nom', input_html: { value: attendee.lastname}, disabled: true, required: false %>
        </div>
        <div style='display:flex;justify-content:space-around;'>
          <%= f.input :employee_id, label: 'N°WWID', input_html: { value: attendee.employee_id }, disabled: true, required: false %>
          <%= f.input :email, input_html: { value: attendee.email }, disabled: true, required: false %>
        </div>
      <% elsif status && Attendee.where(email: params[:search][:email]).empty? %>
        <% controller.redirect_to new_attendee_path(training_id: @training.id, email: params[:search][:email]) %>
      <% else %>
        <%= f.input :email, label: 'Adresse email' %>
        <p class="center-button"> <%= f.submit 'Connexion', class: 'btn btn-edit' %> </p>
      <% end %>
    <% end %>
  </div>
  <% if !@sessions.nil? && ((params[:search] && !Attendee.where(email: params[:search][:email]).empty?) || (params[:attendee] && !Attendee.find(params[:attendee].to_i).nil?)) %>
    <div class='container-seven-form'>
      <h3><strong>Formations à venir</strong></h3>
      <% @sessions.order('date ASC').each do |session| %>
        <div class="session-form-card center-button">
          <div class="session-form-card-left">
            <% if @sessions.order('date ASC').first == session %>
              <div class="session-form-card-image-1">

              </div>
            <% end %>
          </div>
          <div class="session-form-card-right">
            <div>
              <h3><strong><%= session.title %></strong></h3>
              <h5><%= session.date.strftime('%d/%m/%y') %></h5>
            </div>
            <% if @sessions.order('date ASC').first == session %>
              <p class='session-teaser'>Découvrez la négociation raisonnée
                  sur la base des enseignements de Saint-Cyr, école des officiers, et les meilleures techniques de facilitation des forces spéciales au travers d'une simulation engageante.</p>
            <% end %>
            <% if (session.attendees.count >= session.attendee_number) && session.attendees.where(email: params[:search][:email]).empty? %>
              <div class="session-form-control">
                <p>Plus de places pour cette session</p>
              </div>
            <% elsif (params[:search] && session.attendees.where(email: params[:search][:email]).empty?) || (params[:attendee] && session.attendees.where(email: Attendee.find(params[:attendee].to_i).email).empty?) %>
              <div class='session-form-control'>
                <p>Cliquez pour vous inscrire</p>
                <%= link_to "S'inscrire", training_session_session_attendees_path(@training, session, session_id: session.id, attendee_id: @attendee.id), method: :post, class: 'btn btn-edit-green btn-edit-disk' %>
              </div>
            <% else %>
              <div class='session-form-control'>
                <p>Vous êtes déjà inscrit à cette session</p>
                <%= link_to "Se désinscrire", training_session_session_attendee_path(@training, session, @session_attendee, session_id: session.id, attendee_id: @attendee.id), method: :delete, data: { confirm: "Vous êtes sur le point de vous désinscrire de la session #{session.title}. Continer ?"}, class: 'btn btn-edit-red btn-edit-trash' %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif status && Attendee.where(email: params[:search][:email]).empty? %>
    <% flash[:notice] = "Aucun compte ne correspond à l'adresse email renseignée" %>
  <% end %>
  <div id="form-import">
    <% if user_signed_in? && (['super admin', 'admin', 'training manager'].include? current_user.access_level) %>
      <%= form_tag import_attendees_path, multipart: true do %>
        <%= file_field_tag :file %>
        <%= submit_tag 'Import CSV' %>
      <% end %>
    <% end %>
  </div>
</div>
